<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_51) on Sat Mar 31 08:47:42 EDT 2018 -->
<title>MessageLogger</title>
<meta name="date" content="2018-03-31">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="MessageLogger";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/qbroker/jms/MessageInputStream.html" title="class in org.qbroker.jms"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/qbroker/jms/MessageOutputStream.html" title="class in org.qbroker.jms"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/qbroker/jms/MessageLogger.html" target="_top">Frames</a></li>
<li><a href="MessageLogger.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.qbroker.jms</div>
<h2 title="Class MessageLogger" class="title">Class MessageLogger</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.qbroker.jms.MessageLogger</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">MessageLogger</span>
extends java.lang.Object</pre>
<div class="block">MessageLogger handles common logs as JMS Messages.
<br/><br/>
 There are three methods, fetch(), download() and append().  The former is
 NOT MT-Safe.  During the fetch operation, the message acknowledgement and
 session transaction are supported via explicitly persisting reference.
 The method of download() is used for synchronous requests.  The method of
 append() is used for asynchronous logging or storing.
<br/><br/>
 For fetch(), there are 4 different transaction mode determined by XAMode.
 For XAMode = 1 or 3, the client based transcation is enabled so that the
 commit is done by the persister when it completes to persist the message.
 If XAMode = 2, the session commit is enabled so that the commit will be done
 when the read operation finishes and the log file is closed.  The session
 can be forced to termination if MaxNumberMessage is larger than 0 and the
 total number of processed logs and dropped logs exceeds it. For XAMode = 0,
 the auto commit is enabled.  In this case, the persistence of the state info
 is determined by SaveReference. By default, SaveReference is set to be true.
 It means the state info will be flushed to the disk on every processed log
 entry. If SaveReference is set to false, otherwise, the state info will not
 saved to the reference file.
<br/><br/>
 In case of charSet and encoding, you can overwrite the default encoding by
 starting JVM with "-Dfile.encoding=ISO8859_1 your_class".
<br/></div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>yannanlu@yahoo.com</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#MessageLogger(java.util.Map)">MessageLogger</a></strong>(java.util.Map&nbsp;props)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#acknowledge(long[])">acknowledge</a></strong>(long[]&nbsp;state)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#append(org.qbroker.common.XQueue)">append</a></strong>(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)</code>
<div class="block">It gets a JMS Message from an XQueue and append the formatted content
 to the logfile continuously, or store the content to a file.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#commit()">commit</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#download(org.qbroker.common.XQueue)">download</a></strong>(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)</code>
<div class="block">It gets a JMS message from xq that contains a filename to be downloaded
 and downloads the local file.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#fetch(org.qbroker.common.XQueue)">fetch</a></strong>(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)</code>
<div class="block">It fetches new log entries from the logfile and packages them
 into JMS Messages and add the messages to an XQueue.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#getOperation()">getOperation</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/qbroker/jms/MessageLogger.html#rollback()">rollback</a></strong>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="MessageLogger(java.util.Map)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>MessageLogger</h4>
<pre>public&nbsp;MessageLogger(java.util.Map&nbsp;props)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="fetch(org.qbroker.common.XQueue)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>fetch</h4>
<pre>public&nbsp;void&nbsp;fetch(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)
           throws java.io.IOException,
                  javax.jms.JMSException</pre>
<div class="block">It fetches new log entries from the logfile and packages them
 into JMS Messages and add the messages to an XQueue.
 It has the acknowledge support or session transcation support if
 the XAMode is enabled.  With the session transaction, the application
 has to call commit() explicitly to persist the reference.
<br/><br/>
 For those nohit log entries, it will commit them anyway.  This may
 break the client transaction control.  So please make sure to use
 the correct pattern to catch all entries.
<br/><br/>
 This method is NOT MT-Safe.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="download(org.qbroker.common.XQueue)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>download</h4>
<pre>public&nbsp;void&nbsp;download(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)
              throws java.io.IOException,
                     javax.jms.JMSException</pre>
<div class="block">It gets a JMS message from xq that contains a filename to be downloaded
 and downloads the local file.  It puts the content of the file into
 the message body and sends it back.  The requester at the other end
 of the xq can easily read the content out of the message.
<br/><br/>
 Since the download operation relies on a request, this method will
 intercept the request and process it.  The incoming message is required
 to be writeable.  The method will set a String property of the message
 specified by the RCField with the return code, indicating the status
 of the process to fulfill the request.  The requester is required to
 check the value of the property once it gets the message back.  If
 the return code is 0, the download is successful.  Otherwise, the
 message body will not contain the content out of download operation.
<br/><br/>
 This method will not acknowledge messages.  It is up to the requester to
 do that.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="append(org.qbroker.common.XQueue)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>append</h4>
<pre>public&nbsp;void&nbsp;append(<a href="../../../org/qbroker/common/XQueue.html" title="interface in org.qbroker.common">XQueue</a>&nbsp;xq)
            throws java.io.IOException,
                   javax.jms.JMSException</pre>
<div class="block">It gets a JMS Message from an XQueue and append the formatted content
 to the logfile continuously, or store the content to a file.
<br/><br/>
 The store or append operation also supports requests.  If the XAMode has
 enabled the XA_CLIENT bit, it will treat the message as a request from
 the uplink.  In this case, the incoming message is required
 to be writeable.  The method will set a String property of the message
 specified by the RCField with the return code, indicating the status
 of the process to fulfill the request.  The requester is supposed to
 check the value of the property once it gets the message back.  If
 the return code is 0, the operation is successful.  Otherwise, the
 request will be dropped due to failures.  On the other hand, if the
 XA_CLIENT bit has been disabled by XAMode, the incoming message will
 not be modified.
<br/><br/>
 If the XQueue has enabled the EXTERNAL_XA, it will also acknowledge
 the messages.  This method is MT-Safe.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="rollback()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>rollback</h4>
<pre>public&nbsp;void&nbsp;rollback()
              throws javax.jms.JMSException</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="commit()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>commit</h4>
<pre>public&nbsp;void&nbsp;commit()
            throws javax.jms.JMSException</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="acknowledge(long[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>acknowledge</h4>
<pre>public&nbsp;void&nbsp;acknowledge(long[]&nbsp;state)
                 throws javax.jms.JMSException</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>javax.jms.JMSException</code></dd></dl>
</li>
</ul>
<a name="getOperation()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getOperation</h4>
<pre>public&nbsp;java.lang.String&nbsp;getOperation()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/qbroker/jms/MessageInputStream.html" title="class in org.qbroker.jms"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/qbroker/jms/MessageOutputStream.html" title="class in org.qbroker.jms"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/qbroker/jms/MessageLogger.html" target="_top">Frames</a></li>
<li><a href="MessageLogger.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
